"use strict";var EncMap={},MapConfig={url:"http://10.19.151.238:8080/geoserver/gas/ows?service=WFS",wfs:{featureNS:"gas",srsName:"EPSG:3857",featurePrefix:"gas",featureTypes:["t_CSGX_Station","t_CSGX","t_QDM_FWFW"],outputFormat:"application/json"}};EncMap.encGraphicLayer=null,EncMap.encVectorSource=null,EncMap.encDraw=null,EncMap.encHeatMap={baiduGradient:["#00f","#0ff","#0f0","#ff0","#f00"],arcgisGradient:["rgba(0, 0, 255, 0)","rgb(0, 0, 255)","rgb(255, 0, 255)","rgb(255,69, 0)"]},EncMap.encHtmlPopup=null,EncMap.encTempLayerArray=[],EncMap.Map=function(id,mapoptions,mapCompleteCallback){var me=this;this.addLayer=function(e,t){(e.get("layerId")||t)&&(e.get("layerId")?(this.encmap.addLayer(e),t&&e.set("layerId",t)):(this.encmap.addLayer(e),e.set("layerId",t)))},this.findLayerByID=function(e){for(var t=this.encmap.getLayers(),r=t.getLength(),n=0;n<r;n++)if(e===t.item(n).get("layerId"))return t.item(n);return null},this.findOverlayByID=function(e){return this.encmap.getOverlayById(e)},this.addOverlay=function(e,t){(e.get("layerId")||t)&&(e.get("layerId")?(this.encmap.addLayer(e),t&&e.set("layerId",t)):(this.encmap.addLayer(e),e.set("layerId",t)))},this.addLayers=function(e){},this.addArcTileGISLayer=function(e){var t=new ol.layer.Tile({extent:[-13884991,2870341,-7455066,6338219],source:new ol.source.TileArcGISRest({url:e})});this.encmap.addLayer(t)},this.removeLayer=function(e){this.encmap.removeLayer(e)},this.removeOverlay=function(e){this.encmap.removeOverlay(e)},this.clearAllOverlays=function(){this.encmap.getOverlays().clear()},this.removeAllOverlays=function(){for(var e=this.encmap.getOverlays().getArray(),t=this.encmap.getOverlays().getArray().length,r=0;r<t;r++)e[r].setPosition(void 0)},this.getXY=function(r){this.encmap.on("click",function(e){var t={};t.coordinate=e.coordinate,t.pixel=e.pixel,r(t)})},this.showLayer=function(e){for(var t=0;t<this.encmap.getLayers().getArray().length;t++){if("VECTOR"==this.encmap.getLayers().getArray()[t].type)this.encmap.getLayers().getArray()[t].get("layerId")==e&&me.encmap.getLayers().getArray()[t].setVisible(!0);else if("TILE"==this.encmap.getLayers().getArray()[t].type){if(e==me.encmap.getLayers().getArray()[t].getSource().getParams().LAYERS)return me.encmap.getLayers().getArray()[t].setVisible(!0)}}},this.hideLayer=function(e){for(var t=0;t<this.encmap.getLayers().getArray().length;t++){if("VECTOR"==this.encmap.getLayers().getArray()[t].type)this.encmap.getLayers().getArray()[t].get("layerId")==e&&me.encmap.getLayers().getArray()[t].setVisible(!1);else if("TILE"==this.encmap.getLayers().getArray()[t].type){if(e==this.encmap.getLayers().getArray()[t].getSource().getParams().LAYERS)return me.encmap.getLayers().getArray()[t].setVisible(!1)}}},this.removeFeature=function(){null!=EncMap.encVectorSource&&EncMap.encVectorSource.clear()},this.removeFeatureInVector=function(e){e.getSource().clear()},this.switchLayerVisible=function(e){switch(e.getVisible()){case!0:e.setVisible(!1);break;case!1:e.setVisible(!0)}},this.removeLayerByAttribute=function(e,t){for(var r=EncMap.encVectorSource.getFeatures(),n=0;n<r.length;n++){r[n].getProperties().attributes[e]===t&&EncMap.encVectorSource.removeFeature(r[n])}},this.zoomAndCenter=function(e,t,r){var n=e.encmap.getView();n.setZoom(r),n.setCenter(ol.extent.getCenter(t.getGeometry().getExtent()))},this.setZoom=function(e){this.encmap.getView().setZoom(e)},this.fitView=function(e){this.encmap.getView().fit(e)},this.getZoom=function(e){e(this.encmap.getView().getZoom())},this.zoomAndCenterByCoords=function(e,t,r,n){var a=e.encmap.getView();a.setZoom(n),a.setCenter([t,r])},this.onMapZoomEnd=function(_zoomWhere,_callback){var _map=this.encmap,currZoom=_map.getView().getZoom();_map.on("moveend",function(e){var newZoom=_map.getView().getZoom();if(currZoom!=newZoom){var strWhere=newZoom+_zoomWhere;eval(strWhere)?_callback(!0):_callback(!1)}else _callback(!1)})},this.pointCursor=function(n){var a=this.encmap;a.on("pointermove",function(e){var t=a.getEventPixel(e.originalEvent),r=a.forEachFeatureAtPixel(t,function(e,t){return n?(n=n.toLocaleLowerCase(),t.get("layerId").toLocaleLowerCase()==n?e:void 0):e});a.getTargetElement().style.cursor=null==r?"auto":"pointer"})},this.getAreaCenter=function(e){for(var t=e.getSource().getFeatures(),r=[],n=0;n<t.length;n++){var a=t[n],o=ol.extent.getCenter(a.getGeometry().getExtent()),l={};l.attributes=a.getProperties(),l.attributes.x=o[0],l.attributes.y=o[1],r.push(l)}return r},this.getLayerIndex=function(e){for(var t=-1,r=this.encmap.getLayers(),n=r.getLength(),a=0;a<n;a++)if(e==r.item(a).get("layerId")){t=a;break}return t},this.setLayerIndex=function(e,t){for(var r=this.encmap.getLayers(),n=r.getLength(),a=null,o=0;o<n;o++)if(e==r.item(o).get("layerId")){a=r.getArray()[o];break}a&&(this.encmap.removeLayer(a),this.encmap.getLayers().insertAt(t,a))},this.setProjection=function(e,t){return new ol.proj.Projection({code:e,axisOrientation:t})},function(){var e=new ol.control.ScaleLine({units:"metric"});new ol.control.Zoom;EncMap.encVectorSource=new ol.source.Vector({wrapX:!1}),EncMap.encGraphicLayer=new ol.layer.Vector({crossOrigin:"anonymous",source:EncMap.encVectorSource}),mapoptions.layer.push(EncMap.encGraphicLayer);var t={controls:ol.control.defaults({attribution:!1,zoom:!1}).extend([e]),target:id,loadTilesWhileInteracting:!0,layers:mapoptions.layer,view:new ol.View({center:[parseFloat(mapoptions.centerX),parseFloat(mapoptions.centerY)],zoom:Number(mapoptions.zoom),minZoom:Number(mapoptions.minZoom)?Number(mapoptions.minZoom):0,maxZoom:Number(mapoptions.maxZoom)?Number(mapoptions.maxZoom):19})};me.encmap=new ol.Map(t),mapCompleteCallback&&me.encmap.once("postrender",function(e){mapCompleteCallback(!0)})}()},EncMap.ENCLayerProvider=function(){this.getArcGISTileLayer=function(e,t,r,n){if(t){var a=new ol.layer.Tile({source:new ol.source.TileArcGISRest({url:e})});return a.set("layerId",t),a.set("attributes",n),r&&a.set("layerName",r),a}return null},this.getWMSTileLayer=function(e,t,r,n){if(r){var a=t.SRS?t.SRS:"ESPG:3857",o=new ol.proj.get(a);"enu"!=o.getAxisOrientation()&&o.axisOrientation_&&(o.axisOrientation_="enu");var l=o.getExtent(),i=t.origin?t.origin:ol.extent.getTopLeft(l),c=[];if(t.resolutions&&0<t.resolutions.length)c=t.resolutions;else for(var s=0;s<20;s++)c[s]=0==s?Number(t.maxRatio):c[s-1]/2;var u=new ol.tilegrid.TileGrid({origin:i,resolutions:c}),y=new ol.layer.Tile({source:new ol.source.TileWMS({url:e,params:{LAYERS:t.layers,FORMAT:t.format,SRS:t.SRS},projection:o,tileGrid:u}),opacity:t.opacity?t.opacity:1,visible:!t.visible||t.visible});return y.set("layerId",r),y.set("attributes",t),n&&y.set("layerName",n),y}return null},this.getTileLayer=function(e,t,r,n,a){if(null==(t&&r))return null;a=a||"1=1";var o=new ol.layer.Tile({source:new ol.source.TileWMS({crossOrigin:"anonymous",url:e,wrapX:!1,params:{FORMAT:"image/png",VERSION:t,tiled:!0,STYLES:"",LAYERS:r,CQL_FILTER:a}})});return n&&o.set("layerName",n),o.set("layerId",r),o},this.getTileLayerByParam=function(e){if(null==(e.version&&e.typeName))return null;e._cqlFilter||(e._cqlFilter="1=1");var t=new ol.layer.Tile({source:new ol.source.TileWMS({crossOrigin:"anonymous",url:e.url,wrapX:!1,params:{FORMAT:"image/png",VERSION:e.version,tiled:!0,STYLES:"",LAYERS:e.typeName,CQL_FILTER:e._cqlFilter}}),opacity:e.opacity?e.opacity:1,visible:!e.visible||e.visible});return e.layerName&&t.set("layerName",e.layerId),t.set("attributes",e),t.set("layerId",e.typeName),t},this.getVectorLayer=function(e,t,r,n){if(null==t)return null;var a=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON}),opacity:n||1});return r&&a.set("layerName",r),a.set("layerId",t),a},this.getVectorLayerByParam=function(e){if(null==e.url||null==e.typeName)return null;var t=e.service||"WFS",r=e.serviceVersion||"1.0.0",n=e.request||"GetFeature",a=e.typeName,o=e.outputFormat||"application%2Fjson",l=e.layerId||e.typeName,i=e.cqlFilter||"1=1",c=e.opacity?e.opacity:1,s=!e.visible||e.visible,u=e.style;if(e.maxFeatures)var y=e.maxFeatures||"50",m=e.url+"?service="+t+"&version="+r+"&request="+n+"&typeName="+a+"&maxFeatures="+y+"&outputFormat="+o+"&cql_filter="+i;else m=e.url+"?service="+t+"&version="+r+"&request="+n+"&typeName="+a+"&outputFormat="+o+"&cql_filter="+i;var p=new ol.layer.Vector({source:new ol.source.Vector({url:m,format:new ol.format.GeoJSON}),opacity:c,visible:s,style:u});return e.layerName&&p.set("layerName",e.layerName),p.set("layerId",l),p.set("attributes",e),p},this.getTempLayer=function(){var e=new ol.source.Vector({wrapX:!1});return new ol.layer.Vector({crossOrigin:"anonymous",source:e})},this.getTempOverlay=function(e){var t=document.getElementById(e),r=null;return t&&(r=new ol.Overlay({position:[0,0],positioning:"center-bottom",element:t})),r},this.getHeatmapLayer=function(e){var t;if(e.url)t=new ol.source.Vector({url:e.url,format:new ol.format.GeoJSON});else{if(!e.features)return null;t=new ol.source.Vector({features:e.features})}return new ol.layer.Heatmap({source:t,layerId:"heatLayer",gradient:EncMap.encHeatMap.baiduGradient,blur:15,radius:e.radius||8})},this.getBaiduMapLayer=function(e){var t=e.scrollWheelZoom||!0,r=new BMap.Map(e.mapdiv,{minZoom:e.minZoom,maxZoom:e.maxZoom}),n=e.zoom;if(e.point){var a=e.point.x,o=e.point.y,l=new BMap.Point(a,o);r.centerAndZoom(l,n)}else e.city&&r.centerAndZoom(e.city,n);switch(t){case!0:r.enableScrollWheelZoom();break;case!1:r.disableScrollWheelZoom()}return r},this.getClusterLayer=function(e){for(var t=new ol.source.Vector,r=0;r<e.length;r++){var n=new ol.Feature({geometry:new ol.geom.Point(e[r])});t.addFeature(n)}var a=new ol.source.Cluster({distance:5,source:t});return new ol.layer.Vector({source:a,style:function(e){return function(e){var t=e.get("features").length;return new ol.style.Style({image:new ol.style.Circle({radius:15,stroke:new ol.style.Stroke({color:"#fff"}),fill:new ol.style.Fill({color:"#3399CC"})}),text:new ol.style.Text({font:"15px sans-serif",text:t.toString(),fill:new ol.style.Fill({color:"#fff"})})})}(e)}})}},EncMap.ENCAttributeQuery=function(){this.accurateQuery=function(e,t,r,n){var a=e.url,o={featureNS:e.featureNS,srsName:e.srsName,featurePrefix:e.featurePrefix,featureTypes:e.featureTypes,outputFormat:e.outputFormat};o.filter=ol.format.filter.equalTo(t,r);var l=(new ol.format.WFS).writeGetFeature(o);fetch(a,{method:"POST",body:(new XMLSerializer).serializeToString(l)}).then(function(e){return e.json()}).then(function(e){var t=(new ol.format.GeoJSON).readFeatures(e);n(t)})},this.fuzzyQuery=function(e,t,r,n,a){var o=e.url,l={featureNS:e.featureNS,srsName:e.srsName,featurePrefix:e.featurePrefix,featureTypes:e.featureTypes,outputFormat:e.outputFormat};l.filter=n?ol.format.filter.between(t,r+"-01-01",r+"-12-31"):ol.format.filter.like(t,"*"+r+"*");var i=(new ol.format.WFS).writeGetFeature(l);fetch(o,{method:"POST",body:(new XMLSerializer).serializeToString(i)}).then(function(e){return e.json()}).then(function(e){var t=(new ol.format.GeoJSON).readFeatures(e);a(t)})}},EncMap.ENCCombinationQuery=function(){this.boxCombinationQuery=function(o,l,i,c){null!=EncMap.encDraw&&(o.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.DragBox({style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})}),o.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("boxend",function(){o.encmap.removeInteraction(EncMap.encDraw);var e=EncMap.encDraw.getGeometry();EncMap.encDraw=null;var t=MapConfig.wfs,r=ol.format.filter.like(l,"*"+i+"*"),n=new ol.format.filter.Intersects("the_geom",e);t.filter=new ol.format.filter.and(r,n);var a=(new ol.format.WFS).writeGetFeature(t);fetch(MapConfig.url,{method:"POST",body:(new XMLSerializer).serializeToString(a)}).then(function(e){return e.json()}).then(function(e){var t=(new ol.format.GeoJSON).readFeatures(e);c(t)})})}},EncMap.ENCSpatialQuery=function(){this.pointSpacatialQuery=function(r,e,n){null!=EncMap.encDraw&&(r.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.Select({style:new ol.style.Style({image:new ol.style.Circle({radius:.1,fill:new ol.style.Fill({color:"blue"})})}),layers:e}),r.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("select",function(e){r.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null;var t=e.selected[0];null==t.get("features")||null==t.get("features")?n(e.selected[0]):n(e.selected[0].getProperties().features)})},this.boxSpacatialQuery=function(n,a,o){null!=EncMap.encDraw&&(n.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.DragBox({style:new ol.style.Style({stroke:new ol.style.Stroke({color:[0,0,255,1]})})}),n.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("boxend",function(){n.encmap.removeInteraction(EncMap.encDraw);var e=EncMap.encDraw.getGeometry();EncMap.encDraw=null;var t=a.wfs;t.filter=new ol.format.filter.Intersects("the_geom",e);var r=(new ol.format.WFS).writeGetFeature(t);fetch(a.url,{method:"POST",body:(new XMLSerializer).serializeToString(r)}).then(function(e){return e.json()}).then(function(e){var t=(new ol.format.GeoJSON).readFeatures(e);o(t)})})},this.vectorQuery=function(e,r,n){null!=EncMap.encDraw&&(e.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.Select({style:new ol.style.Style({image:new ol.style.Circle({radius:.1,fill:new ol.style.Fill({color:"blue"})})}),filter:function(e,t){return-1!=r.indexOf(t.get("layerId"))},hitTolerance:1}),e.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("select",function(e){if(null!=e.selected[0]){var t={};t=e.selected[0].getProperties().attributes?e.selected[0].getProperties().attributes:e.selected[0].getProperties(),"Point"==e.selected[0].getGeometry().getType()?(t.x=e.selected[0].getGeometry().getCoordinates()[0]?e.selected[0].getGeometry().getCoordinates()[0]:0,t.y=e.selected[0].getGeometry().getCoordinates()[1]?e.selected[0].getGeometry().getCoordinates()[1]:0):(t.x=e.mapBrowserEvent.coordinate[0]?e.mapBrowserEvent.coordinate[0]:0,t.y=e.mapBrowserEvent.coordinate[1]?e.mapBrowserEvent.coordinate[1]:0),n(t)}})},this.destoryVectorQuery=function(e){null!=EncMap.encDraw&&(e.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null)},this.clearSelectedStyle=function(){null!=EncMap.encDraw&&EncMap.encDraw.getFeatures().clear()}},EncMap.ENCHighlightVector=function(){var u;this.setHighlightVector=function(r,n,a,o,t){r.encmap.on("pointermove",function(e){if(!e.dragging){var t=r.encmap.getEventPixel(e.originalEvent);s(t)}});var l,i={},c=(new ol.style.Style,new ol.layer.Vector({source:new ol.source.Vector,style:function(e,t){var r=t<5e3?e.get(n):"";return i[r]||(i[r]=new ol.style.Style({stroke:new ol.style.Stroke({color:a.strokecolor?a.strokecolor:"#4AF5FD",width:2}),fill:new ol.style.Fill({color:"rgba(33, 81, 165, "+o+")"}),text:new ol.style.Text({font:a.font?a.font:"18px Calibri,sans-serif",text:r,fill:new ol.style.Fill({color:a.textcolor?a.textcolor:"#7bc0ff"})})})),i[r]}}));c.set("layerId","highlight"),r.encmap.getLayers().insertAt(1,c);var s=function(e){var t=r.encmap.forEachFeatureAtPixel(e,function(e){return e});t!==l&&(l&&c.getSource().removeFeature(l),t&&c.getSource().addFeature(t),l=t)};t&&(u=new ol.interaction.Select({condition:ol.events.condition.click,layers:[c],style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgba(74, 245, 253, 1)",width:2}),fill:new ol.style.Fill({color:"rgba(33, 81, 165, 0)"})})}),r.encmap.addInteraction(u),u.on("select",function(e){null!=e.selected[0]&&t(e.selected[0])}))},this.removeHighlightVector=function(e){e.encmap.un("pointermove");for(var t=e.encmap.getLayers(),r=t.getLength(),n=0;n<r;n++)if("highlight"==t.item(n).get("layerId")){e.encmap.removeLayer(t.item(n));break}u.getFeatures().clear(),e.encmap.removeInteraction(u)}},EncMap.EncAddShapeTool=function(){this.addPoint=function(e){var t=new ol.Feature({geometry:new ol.geom.Point(e)});t.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:17,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(t)},this.addSolidline=function(e){var t=new ol.Feature({geometry:new ol.geom.LineString(e)});t.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:5}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(t)},this.addCircle=function(e,t){var r=new ol.Feature({geometry:new ol.geom.Circle(e,t)});r.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.5)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:6}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(r)},this.addSquare=function(e,t){var r=new ol.geom.Circle(e,t),n=new ol.Feature({geometry:new ol.geom.Polygon.fromCircle(r,4,150)});n.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.5)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:6}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(n)},this.addRectangle=function(e){var t=new ol.Feature({geometry:new ol.geom.Polygon.fromExtent(e)});t.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(33,33,33,0.5)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:4}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(t)},this.addPolygon=function(e){var t=new ol.Feature({geometry:new ol.geom.Polygon([e])});t.setStyle(new ol.style.Style({fill:new ol.style.Fill({color:"rgba(33,33,33,0.5)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:4}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})),EncMap.encVectorSource.addFeature(t)},this.addMarks=function(e,t,r,n,a){var o=null;if(!(n=n||EncMap.encGraphicLayer).getSource()){var l=new ol.source.Vector({wrapX:!1});n.setSource(l)}for(var i=0;i<t.length;i++){o=new ol.Feature({geometry:new ol.geom.Point([t[i].attributes.x,t[i].attributes.y]),attributes:t[i].attributes});var c=new ol.style.Style;if(r.src){var s=new ol.style.Icon({src:r.src,scale:r.scale?r.scale:1,anchor:r.anchor?r.anchor:[.5,.5]});c.setImage(s)}if(r.text){var u=new ol.style.Text({font:r.font,text:t[i].attributes[r.text].toString(),fill:new ol.style.Fill({color:r.fill}),offsetX:r.offset&&r.offset[0]?r.offset[0]:0,offsetY:r.offset&&r.offset[1]?r.offset[1]:0});c.setText(u)}o.setStyle(c),n.getSource().addFeature(o)}a&&(null!=EncMap.encDraw&&(e.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.Select({condition:ol.events.condition.click,layers:[n]}),e.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("select",function(e){if(null!=e.selected[0]){var t=e.selected[0].getProperties().attributes;t.x=e.selected[0].getGeometry().getCoordinates()[0]?e.selected[0].getGeometry().getCoordinates()[0]:0,t.y=e.selected[0].getGeometry().getCoordinates()[1]?e.selected[0].getGeometry().getCoordinates()[1]:0,a(t)}}))},this.addMarksByOverlay=function(e,t,r,n,a){for(var o=0;o<t.length;o++){var l=document.getElementById(n);if(l.id=n,document.getElementById("overlay"+o)){var i=e.encmap.getOverlayById("overlay"+o);e.encmap.removeOverlay(i)}var c=document.createElement("div");c.id="overlay"+o,c.style.width=r.width,c.style.height=r.height,c.attr=t[o].attributes,c.x=t[o].attributes.x,c.y=t[o].attributes.y,l.appendChild(c);var s=new ol.Overlay({id:"overlay"+o,positioning:"center-center",attributes:t[o].attributes,element:document.getElementById("overlay"+o),stopEvent:!1});e.encmap.addOverlay(s);var u=r.src;document.getElementById("overlay"+o).style.backgroundImage="url("+u+")",s.setPosition([t[o].attributes.x,t[o].attributes.y]),a&&(document.getElementById("overlay"+o).onclick=function(e){if(e.currentTarget.attr){var t=e.currentTarget.attr;t.x=e.currentTarget.attr.x?e.currentTarget.attr.x:0,t.y=e.currentTarget.attr.y?e.currentTarget.attr.y:0,a(t)}})}},this.addPointMark=function(e,t,r,n,a){if(0<n.getSource().getFeatures().length)n.getSource().clear();else{for(var o=0,l=0,i=0;i<EncMap.encTempLayerArray.length;i++)n.get("layerId")==EncMap.encTempLayerArray[i].get("layerId")&&(o=i,l++);0==l&&(o=0==EncMap.encTempLayerArray.length?(EncMap.encTempLayerArray.push(n),0):(EncMap.encTempLayerArray.push(n),EncMap.encTempLayerArray.length-1));for(var c=0;c<t.length;c++){var s=new ol.Feature({geometry:new ol.geom.Point([t[c].attributes.x,t[c].attributes.y]),attributes:t[c].attributes});s.setStyle(new ol.style.Style({image:new ol.style.Icon({src:r.src,scale:r.scale})})),EncMap.encTempLayerArray[o].getSource().addFeature(s)}a&&(null!=EncMap.encDraw&&(e.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.Select({condition:ol.events.condition.click,layers:EncMap.encTempLayerArray}),e.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("select",function(e){if(null!=e.selected[0]){var t=e.selected[0].getProperties().attributes;t.x=e.selected[0].getGeometry().getCoordinates()[0]?e.selected[0].getGeometry().getCoordinates()[0]:0,t.y=e.selected[0].getGeometry().getCoordinates()[1]?e.selected[0].getGeometry().getCoordinates()[1]:0,a(t)}}))}},this.addTypeFeature=function(e,t,r,n){if(0<r.getSource().getFeatures().length)r.getSource().clear();else{for(var a=0,o=0;o<EncMap.encTempLayerArray.length;o++)r.get("layerId")==EncMap.encTempLayerArray[o].get("layerId")&&(o,a++);0==a&&(0==EncMap.encTempLayerArray.length?(EncMap.encTempLayerArray.push(r),0):(EncMap.encTempLayerArray.push(r),EncMap.encTempLayerArray.length-1));for(var l=0;l<t.length;l++){var i=new ol.Feature({geometry:new ol.geom.Point([t[l].attributes.x,t[l].attributes.y]),attributes:t[l].attributes});i.setStyle(new ol.style.Style({image:new ol.style.Icon({src:t[l].imgParam.src,scale:t[l].imgParam.scale})})),r.getSource().addFeature(i)}n&&(null!=EncMap.encDraw&&(e.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),EncMap.encDraw=new ol.interaction.Select({condition:ol.events.condition.click,layers:EncMap.encTempLayerArray}),e.encmap.addInteraction(EncMap.encDraw),EncMap.encDraw.on("select",function(e){if(null!=e.selected[0]){var t=e.selected[0].getProperties().attributes;t.x=e.selected[0].getGeometry().getCoordinates()[0]?e.selected[0].getGeometry().getCoordinates()[0]:0,t.y=e.selected[0].getGeometry().getCoordinates()[1]?e.selected[0].getGeometry().getCoordinates()[1]:0,n(t)}}))}},this.addFeatures=function(e,t){e&&t&&((t.length=1)?e.addFeature(t):e.addFeatures(t))}},EncMap.EncDrawShapeTool=function(){this.drawShape=function(t,e,r,n){var a,o;(null!=EncMap.encDraw&&(t.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null),"None"!==e)?("Square"===e?(e="Circle",a=ol.interaction.Draw.createRegularPolygon(4)):"Box"===e&&(e="LineString",o=2,a=function(e,t){t=t||new ol.geom.Polygon(null);var r=e[0],n=e[1];return t.setCoordinates([[r,[r[0],n[1]],n,[n[0],r[1]],r]]),t}),EncMap.encDraw=new ol.interaction.Draw({source:EncMap.encVectorSource,type:e,geometryFunction:a,maxPoints:o,freehand:n||!1}),t.encmap.addInteraction(EncMap.encDraw)):EncMap.encVectorSource.clear();r&&EncMap.encDraw.on("drawend",function(e){t.encmap.removeInteraction(EncMap.encDraw),EncMap.encDraw=null,r(e)})}},EncMap.ENCInfowindow=function(){this.showInfowindow=function(e,t,r,n,a,o){var l=document.getElementById(n);if(document.getElementById("popup"+n)){var i=e.encmap.getOverlayById("popup"+n);e.encmap.removeOverlay(i)}var c=document.createElement("div");c.id="popup"+n,l.appendChild(c),EncMap.encHtmlPopup=new ol.Overlay({id:c.id,element:c,stopEvent:o||!1}),c.innerHTML=a,EncMap.encHtmlPopup.setPosition([t,r]),e.encmap.addOverlay(EncMap.encHtmlPopup),EncMap.encHtmlPopup.setPositioning("bottom-center")},this.hideInfowindow=function(){EncMap.encHtmlPopup&&(EncMap.encHtmlPopup.setPosition(void 0),EncMap.encHtmlPopup=null)}},EncMap.EncOptShapeTool=function(){this.measureLength=function(e){return e.getLength()},this.measureArea=function(e){return e.getArea()},this.calculateAll=function(e){for(var t=0,r=e.getSource().getFeatures(),n=r.length,a=0;a<n;a++){t+=r[a].values_.st_length_}return t},this.changeHeatMapRadius=function(e,t){null==t&&(t=8),e.setRadius(t)}},EncMap.EncGeometryProvider=function(){this.getPoints=function(e){var t=[];if(0!=e.length){for(var r=0;r<e.length;r++)t.push(new ol.Feature({geometry:new ol.geom.Point([e[r].attributes.x,e[r].attributes.y]),attributes:e[r].attributes}));return t}},this.getPolyline=function(e){var t=[];if(!(e.length<2)){for(var r=[],n=0;n<e.length;n++)r.push([e[n].attributes.x,e[n].attributes.y]);return t.push(new ol.Feature({geometry:new ol.geom.LineString(r)})),t}},this.getPolygon=function(e){var t=[];if(!(e.length<3)){for(var r=[],n=0;n<e.length;n++)r.push([e[n].attributes.x,e[n].attributes.y]);return t.push(new ol.Feature({geometry:new ol.geom.Polygon(r)})),t}}},EncMap.ENCLayerDefinitionProvider=function(){this.setLayerDefinition=function(e,t,r,n){switch(r){case"wfs":case"WFS":var a=t.getSource().getUrl();if(-1<n.indexOf("%")&&(n=n.replace(/%/g,"%25")),0<=a.indexOf("&CQL_FILTER=")){var o=a.indexOf("&CQL_FILTER=");a=a.slice(0,o+1)}var l=a+"&CQL_FILTER=("+n+")",i=t.get("layerId");e.encmap.removeLayer(t);var c=new ol.layer.Vector({source:new ol.source.Vector({url:l,format:new ol.format.GeoJSON})});c.set("layerId",i),e.encmap.addLayer(c);break;case"wms":case"WMS":var s=t.getSource().getParams();s.CQL_FILTER=n;var u=t.getSource().getUrls()[0];i=t.get("layerId");e.encmap.removeLayer(t);var y=new ol.layer.Tile({source:new ol.source.TileWMS({crossOrigin:"anonymous",url:u,wrapX:!1,params:s})});y.set("layerId",i),e.encmap.addLayer(y)}}},EncMap.ENCThirdPartyProviderQuery=function(){this.baiduAutoCompleteQuery=function(e,a,t,n){var r;r=t||e.getCurrentCity();var o=e,l=new BMap.Autocomplete({input:a,location:r});function i(e){return document.getElementById(e)}l.addEventListener("onhighlight",function(e){var t="",r=e.fromitem.value,n="";-1<e.fromitem.index&&(n=r.province+r.city+r.district+r.street+r.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+n,n="",-1<e.toitem.index&&(n=(r=e.toitem.value).province+r.city+r.district+r.street+r.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+n,i(a).innerHTML=t}),l.addEventListener("onconfirm",function(e){var t=e.item.value,r=t.province+t.city+t.district+t.street+t.business;i(a).innerHTML="onconfirm<br />index = "+e.item.index+"<br />myValue = "+r,function(s,e,y){for(var t=s.getOverlays(),r=0;r<t.length;r++)s.removeOverlay(t[r]);var m=new BMap.LocalSearch(s,{onSearchComplete:function(){var e=m.getResults().getPoi(0).point;s.centerAndZoom(e,18);var u=new BMap.Marker(e);s.addOverlay(u),u.enableDragging(),u.addEventListener("dragend",function(e){var t=e.point;u.setPosition(t);var r=52.35987755982988,n=t.lng-.0065,a=t.lat-.006,o=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),l=Math.atan2(a,n)-3e-6*Math.cos(n*r),i=o*Math.cos(l),c=o*Math.sin(l);t.lng=i*Math.PI/180*6378137;var s=c*Math.PI/180;return t.lat=3189068.5*Math.log((1+Math.sin(s))/(1-Math.sin(s))),y(t)}),s.addEventListener("click",function(e){var t=new BMap.Point(e.point.lng,e.point.lat);u.setPosition(t);var r=52.35987755982988,n=t.lng-.0065,a=t.lat-.006,o=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),l=Math.atan2(a,n)-3e-6*Math.cos(n*r),i=o*Math.cos(l),c=o*Math.sin(l);t.lng=i*Math.PI/180*6378137;var s=c*Math.PI/180;return t.lat=3189068.5*Math.log((1+Math.sin(s))/(1-Math.sin(s))),y(t)});var t=52.35987755982988,r=e.lng-.0065,n=e.lat-.006,a=Math.sqrt(r*r+n*n)-2e-5*Math.sin(n*t),o=Math.atan2(n,r)-3e-6*Math.cos(r*t),l=a*Math.cos(o),i=a*Math.sin(o);e.lng=l*Math.PI/180*6378137;var c=i*Math.PI/180;return e.lat=3189068.5*Math.log((1+Math.sin(c))/(1-Math.sin(c))),y(e)}});m.search(e)}(o,r,n)})},this.baiduAddClickPoint=function(e,t,r,y,n){for(var a=e.getOverlays(),o=0;o<a.length;o++)e.removeOverlay(a[o]);var l=new BMap.Point(t,r),m=new BMap.Marker(l);e.addOverlay(m),m.enableDragging(),m.setPosition(l);var i=52.35987755982988,c=t-.0065,s=r-.006,u=Math.sqrt(c*c+s*s)-2e-5*Math.sin(s*i),p=Math.atan2(s,c)-3e-6*Math.cos(c*i),g=u*Math.cos(p),f=u*Math.sin(p);t=g*Math.PI/180*6378137;var d=f*Math.PI/180;r=3189068.5*Math.log((1+Math.sin(d))/(1-Math.sin(d))),m.addEventListener("dragend",function(e){var t=e.point;m.setPosition(t);var r=52.35987755982988,n=t.lng-.0065,a=t.lat-.006,o=Math.sqrt(n*n+a*a)-2e-5*Math.sin(a*r),l=Math.atan2(a,n)-3e-6*Math.cos(n*r),i=o*Math.cos(l),c=o*Math.sin(l);t.lng=i*Math.PI/180*6378137;var s=c*Math.PI/180;t.lat=3189068.5*Math.log((1+Math.sin(s))/(1-Math.sin(s)));var u=[];u.push(t.lng,t.lat),y(u)}),n([t,r])},this.baiduReLocattion=function(e,t,r){var n=function(e,t){e=e/20037508.34*180;var r=t/20037508.34*180;t=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2);var n=52.35987755982988,a=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*n),o=Math.atan2(t,e)+3e-6*Math.cos(e*n);return e=a*Math.cos(o)+.0065,t=a*Math.sin(o)+.006,{x:e,y:t}}(t,r),a=new BMap.Point(n.x,n.y);e.centerAndZoom(a,18);var o=new BMap.Marker(a);e.addOverlay(o),e.panTo(a)}},EncMap.ENCStyle=function(){this.setStrokeStyle=function(e){var t=new ol.style.Style({stroke:new ol.style.Stroke({width:e.width,color:e.color,lineCap:e.lineCap,lineJoin:e.lineJoin,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,miterLimit:e.miterLimit})});return e.styleName&&(t.styleName=e.styleName),t},this.setIconStyle=function(e){var t=new ol.style.Style({image:new ol.style.Icon({anchor:e.anchor,src:e.src,anchorOrigin:e.anchorOrigin,anchorXUnits:e.anchorXUnits,anchorYUnits:e.anchorYUnits,color:e.color,crossOrigin:e.crossOrigin,img:e.img,offset:e.offset,offsetOrigin:e.offsetOrigin,opacity:e.opacity,scale:e.scale,rotateWithView:e.rotateWithView,rotation:e.rotation,size:e.size,imgSize:e.imgSize})});return e.styleName&&(t.styleName=e.styleName),t},this.setCircleStyle=function(e){var t=new ol.style.Style({image:new ol.style.Circle({radius:e.radius,fill:new ol.style.Fill({color:e.fillColor}),stroke:new ol.style.Stroke({color:e.strokeColor,width:e.strokeWidth,lineCap:e.strokeLineCap,lineJoin:e.strokeLineJoin,lineDash:e.strokeLinedash,lineDashOffset:e.strokeLineDashOffset,miterLimit:e.strokeMiterLimit})})});return e.styleName&&(t.styleName=e.styleName),t},this.setImageTextStyle=function(e,t){if(e.src)return new ol.style.Style({image:new ol.style.Icon({src:e.src,anchor:e.anchor,scale:e.scale,offset:e.offset}),text:new ol.style.Text({font:e.font,text:t,fill:new ol.style.Fill({color:e.fill})})})},this.setTextStyle=function(e,t){return new ol.style.Style({text:new ol.style.Text({font:e.font,text:t,fill:new ol.style.Fill({color:e.fill})})})},this.setFeatureStyle=function(e,t){e.setStyle(t)}},EncMap.ENCRoadLineShow=function(){var u,y,m,p,g,f,d=!0,h=0,r=this.speed,w=[],v=[];function S(e,t,r){null==r&&(r=1),r-=.5;for(var n=25*Math.abs(r),a=e[0],o=e[1],l=(t[0]-a)/n,i=(t[1]-o)/n,c=0;c<=n;){var s=a+c*l,u=o+c*i;w.push([s,u]),c++}}this.initRoad=function(e,t,r,n,a,o){if(y=e,p=r,g=a,f=o,w=[],v=n,(m=t).set("layerId","animationLineLayer"),r.set("layerId","animationPointLayer"),0!=n.length){u&&clearInterval(u),null!=y.findLayerByID("animationLineLayer")&&y.encmap.removeLayer(y.findLayerByID("animationLineLayer")),null!=y.findLayerByID("animationPointLayer")&&y.encmap.removeLayer(y.findLayerByID("animationPointLayer")),d=!0;for(var l=h=0;l<n.length-1;l++)S(n[l],n[l+1]);var i=y.findLayerByID("animationLineLayer"),c=y.findLayerByID("animationPointLayer");null!=i?null!=i.getSource()&&i.getSource().clear():y.encmap.addLayer(t),null!=c?null!=c.getSource()&&c.getSource().clear():y.encmap.addLayer(r);var s=new ol.interaction.Select({condition:ol.events.condition.click,layers:[t]});y.encmap.addInteraction(s),s.on("select",function(e){if(null!=e.selected[0]){this.getFeatures().clear(),h=e.selected[0].get("arrIndex"),m.getSource().clear();for(var t=0;t<=h-1;t++){var r=new ol.Feature({geometry:new ol.geom.LineString([w[t],w[t+1]])});r.set("arrIndex",t),r.setStyle(g),m.getSource().addFeature(r)}var n=new ol.Feature({geometry:new ol.geom.Point(w[h])});n.setStyle(f),p.getSource().clear(),p.getSource().addFeature(n)}})}},this.getRoadLineLayer=function(e,t,r){var n=new ol.geom.LineString(t),a=[new ol.Feature({type:"route",geometry:n})],o=new ol.source.Vector({features:a}),l=new ol.layer.Vector({source:o,style:r}),i=l.getSource().getExtent();null!=i&&e.encmap.getView().fit(i);return l},this.play=function(e){var t=new ol.Feature({geometry:new ol.geom.LineString(v)});y.encmap.getView().fit(t.getGeometry().getExtent()),u&&(clearInterval(u),null!=m.getSource()&&m.getSource().clear(),null!=p.getSource()&&p.getSource().clear(),h=0),r=(r=Number(e))||40,u=setInterval(function(){if(d)if(h>w.length-2)clearInterval(u);else{var e=new ol.Feature({geometry:new ol.geom.LineString([w[h],w[++h]])});e.set("arrIndex",h),e.setStyle(g),m.getSource().addFeature(e);var t=new ol.Feature({geometry:new ol.geom.Point(w[h])});t.setStyle(f),p.getSource().clear(),p.getSource().addFeature(t)}},r)},this.restart=function(e){clearInterval(u),d=!(h=0),e&&(r=e),this.play(r)},this.paused=function(){return u?d=!d:null},this.faster=function(){return clearInterval(u),d=!(u=null),10<r&&(r-=1),this.play(r),r},this.slower=function(){return clearInterval(u),d=!(u=null),r+=1,this.play(r),r}},EncMap.ENCAjax=function(){this.GET=function(e,t,r){axios({url:e,method:"GET",params:t||{}}).then(function(e){e.IS_SUCCESS=!0,e.SUCCESS_TEXT="成功",r(e)}).catch(function(e){e.ISSUCCESS=!1,e.SUCCESS_TEXT="失败",r(e)})},this.POST=function(e,t,r){axios({url:e,method:"POST",data:t||{}}).then(function(e){e.ISSUCCESS=!0,e.SUCCESS_TEXT="成功",r(e)}).catch(function(e){e.ISSUCCESS=!1,e.SUCCESS_TEXT="失败",r(e)})},this.pointQueryByWfs=function(e,t){e.tolerance||(e.tolerance=1);var r=Number(e.x)-Number(e.tolerance)+","+Number(e.y)+Number(e.tolerance),n=Number(e.x)-Number(e.tolerance)+","+(Number(e.y)-Number(e.tolerance)),a=Number(e.x)+Number(e.tolerance)+","+Number(e.y)+Number(e.tolerance),o=r+" "+n+" "+(Number(e.x)+Number(e.tolerance)+","+(Number(e.y)-Number(e.tolerance)))+" "+a+" "+r,l='<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+e.field+"</PropertyName><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></Intersects></Filter>",i=e.url+"?service=WFS&version=1.0.0&request=GetFeature&typeName="+e.typename+"&outputFormat=application%2Fjson";axios({url:i+="&filter="+l,method:"GET"}).then(function(e){t(e)}).catch(function(e){t(e)})},this.getPipeLength=function(e,a){axios({url:e.url,method:"GET"}).then(function(e){if(e.data){for(var t=e.data.features,r=[],n=0;n<t.length;n++)r.push({pipetype:t[n].properties.pipetype,pipelength:t[n].properties.pipelength});a(r)}}).catch(function(e){a(e)})},this.pointQueryByCircleWfs=function(e,t){e.tolerance||(e.tolerance=10);var r=ol.geom.Polygon.fromCircle(new ol.geom.Circle([Number(e.x),Number(e.y)],e.tolerance)),n=new ol.Feature({geometry:r}),a=" INTERSECTS(geom,"+(new ol.format.WKT).writeGeometry(n.getGeometry())+")",o=e.url+"?service=WFS&version=1.0.0&request=GetFeature&typeName="+e.typename+"&outputformat=json&maxFeature=50&"+parseInt(1e5*Math.random())+"&cql_filter="+a;axios({url:o,method:"get"}).then(function(e){e.IS_SUCCESS=!0,e.SUCCESS_TEXT="成功",t(e)}).catch(function(e){e.ISSUCCESS=!1,e.SUCCESS_TEXT="失败",t(e)})},this.modifyFeature=function(e,t,r){var n=(new ol.format.WFS).writeTransaction(null,[t],null,{featureType:e.layername,featureNS:"gas",srsName:"EPSG:3857"}),a=(new XMLSerializer).serializeToString(n),o=e.url+"?service=WFS";axios({url:o,method:"post",data:a,headers:{"Content-Type":"text/xml"}}).then(function(e){e.IS_SUCCESS=!0,e.SUCCESS_TEXT="成功",r("success")}).catch(function(e){e.ISSUCCESS=!1,e.SUCCESS_TEXT="失败",r("fail")})},this.transact=function(e,t,r,n){if(""!=e.layername){var a=new ol.format.WFS,o={featureType:e.layername,featureNS:e.featureNS,srsName:e.srsName},l=null;switch(t){case"insert":var i=r.getGeometry();r.set("geom",null),r.setGeometryName("geom"),r.setGeometry(new ol.geom.MultiLineString([i.getCoordinates()])),l=a.writeTransaction([r],null,null,o);break;case"update":l=a.writeTransaction(null,[r],null,o);break;case"delete":l=a.writeTransaction(null,null,[r],o)}var c=(new XMLSerializer).serializeToString(l),s=e.url+"?service=WFS";axios({url:s,method:"post",data:c,headers:{"Content-Type":"text/xml"}}).then(function(e){e.IS_SUCCESS=!0,e.SUCCESS_TEXT="成功",n("success")}).catch(function(e){e.ISSUCCESS=!1,e.SUCCESS_TEXT="失败",n("fail")})}}},EncMap.ENCLayerControl=function(){function m(e,t){e.onclick=function(){e.checked?t.setVisible(!0):t.setVisible(!1)}}function p(e,t){"string"==typeof e.textContent?e.textContent=t:e.innerText=t}this.loadLayersControl=function(e,t,r){for(var n=new Array,a=new Array,o=new Array,l=document.getElementById(t),i=e.getLayers(),c=0;c<i.getLength();c++){if(n[c]=i.item(c),!n[c].get("layerId"))return;a[c]=n[c].get(r)?n[c].get(r):n[c].get("layerName"),o[c]=n[c].getVisible();var s=document.createElement("li");l.appendChild(s);var u=document.createElement("input");u.type="checkbox",u.name="layers",s.appendChild(u);var y=document.createElement("label");y.className="layer",p(y,a[c]),s.appendChild(y),o[c]&&(u.checked=!0),m(u,n[c])}}};